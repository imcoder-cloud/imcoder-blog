(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ec22531e"],{6407:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-pagination",{attrs:{background:!1,"current-page":e.pageNum,"page-sizes":[5,10,20,30,40,50],"page-size":e.pageSize,layout:e.optionsArr.join(","),total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})},r=[],i={props:{pageSize:{default:10},pageNum:{default:1},total:{default:0}},data:function(){return{optionsArr:["total","sizes","prev","pager","next","jumper"]}},methods:{handleSizeChange:function(e){this.$emit("sizeChange",e)},handleCurrentChange:function(e){this.$emit("currentChange",e)}}},o=i,s=a("4023"),l=Object(s["a"])(o,n,r,!1,null,null,null);t["a"]=l.exports},"6e18":function(e,t,a){"use strict";var n=a("b775"),r="/api/admin/role",i={findAll:function(e){return Object(n["a"])({url:"".concat(r),params:e,method:"get"})},page:function(e){return Object(n["a"])({url:"".concat(r,"/page"),params:e,method:"get"})},get:function(e){return Object(n["a"])({url:"".concat(r,"/").concat(e),method:"get"})},tree:function(){return Object(n["a"])({url:"".concat(r,"/tree"),method:"get"})},create:function(e){return Object(n["a"])({url:"".concat(r),data:e,method:"post"})},update:function(e){return Object(n["a"])({url:"".concat(r),data:e,method:"put"})},delete:function(e){return Object(n["a"])({url:"".concat(r,"/").concat(e),method:"delete"})}};t["a"]=i},d78e:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-card",[a("div",{staticStyle:{"margin-top":"20px"}},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{attrs:{placeholder:"角色名称"},model:{value:e.queryParams.title,callback:function(t){e.$set(e.queryParams,"title",t)},expression:"queryParams.title"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getRoles()}}},[e._v("查询")])],1),a("el-form-item",[e.addPermission?a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showAddForm=!0,e.editParams={},e.selectedPremissionIds=[]}}},[e._v("新增")]):e._e()],1)],1)],1),a("div",{staticStyle:{padding:"20px"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticStyle:{"margin-bottom":"20px"},attrs:{data:e.roles,"element-loading-background":"rgba(0, 0, 0, 0.3)","element-loading-text":"数据正在加载中","element-loading-spinner":"el-icon-loading"}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),a("el-table-column",{attrs:{prop:"name",label:"名称"}}),a("el-table-column",{attrs:{prop:"code",label:"编码"}}),a("el-table-column",{attrs:{prop:"description",label:"描述","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"180"}}),a("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.setPermission?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.getPermission(t.row)}}},[e._v("配置权限")]):e._e(),e.editPermission?a("el-button",{attrs:{type:"text"},on:{click:function(a){e.editParams=t.row,e.showAddForm=!0}}},[e._v("编辑")]):e._e(),e.delPermission?a("el-popconfirm",{staticStyle:{"margin-left":"10px"},attrs:{title:"确定删除本条数据吗？删除后不可恢复。",cancelButtonType:"default"},on:{onConfirm:function(a){return e.del(t.row)}}},["admin"!=t.row.code?a("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("删除")]):e._e()],1):e._e()]}}])})],1),a("pagination",{attrs:{pageNum:e.queryParams.pageNum,pageSize:e.queryParams.pageSize,total:e.total},on:{sizeChange:e.handleSizeChange,currentChange:e.handleCurrentChange}})],1)]),a("el-dialog",{attrs:{title:"编辑角色",width:"500px",visible:e.showAddForm},on:{"update:visible":function(t){e.showAddForm=t}}},[a("el-form",{attrs:{model:e.editParams,"label-position":"right","label-width":"60px"}},[a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{attrs:{disabled:"admin"==e.editParams.code,autocomplete:"off",placeholder:"角色名称"},model:{value:e.editParams.name,callback:function(t){e.$set(e.editParams,"name",t)},expression:"editParams.name"}})],1),a("el-form-item",{attrs:{label:"编码"}},[a("el-input",{attrs:{disabled:"admin"==e.editParams.code,autocomplete:"off",placeholder:"例如：admin"},model:{value:e.editParams.code,callback:function(t){e.$set(e.editParams,"code",t)},expression:"editParams.code"}})],1),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{attrs:{type:"textarea",autocomplete:"off",placeholder:"角色描述"},model:{value:e.editParams.description,callback:function(t){e.$set(e.editParams,"description",t)},expression:"editParams.description"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showAddForm=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveRole}},[e._v("确定")])],1)],1),a("el-dialog",{attrs:{title:"权限配置",width:"500px",visible:e.showPermissionForm},on:{"update:visible":function(t){e.showPermissionForm=t}}},[a("el-tree",{ref:"permissionTree",attrs:{data:e.permissions,"node-key":"id",props:{children:"children",label:"name"},"show-checkbox":"","default-checked-keys":e.selectedPremissionIds}}),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showPermissionForm=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveRolePermission}},[e._v("确定")])],1)],1)],1)},r=[],i=(a("dbb3"),a("fe59"),a("ecb4"),a("2eeb"),a("053b"),a("08ba"),a("6407")),o=a("b775"),s="/api/admin/permission",l={};function c(e,t){t.forEach((function(t){e.key===t.parentId&&(e.children||(e.children=[]),e.children.push({key:t.id,title:t.name,isLeaf:!1}))})),e.children?e.children.forEach((function(e){return c(e,t)})):e.isLeaf=!0}l.findAll=function(e){return Object(o["a"])({url:"".concat(s),params:e,method:"get"})},l.page=function(e){return Object(o["a"])({url:"".concat(s,"/page"),params:e,method:"get"})},l.get=function(e){return Object(o["a"])({url:"".concat(s,"/").concat(e),method:"get"})},l.tree=function(e){return Object(o["a"])({url:"".concat(s,"/tree"),params:e,method:"get"})},l.create=function(e){return Object(o["a"])({url:"".concat(s,"/save"),data:e,method:"post"})},l.update=function(e){return Object(o["a"])({url:"".concat(s,"/update"),data:e,method:"put"})},l.delete=function(e){return Object(o["a"])({url:"".concat(s,"/").concat(e),method:"delete"})},l.concreteTree=function(e){var t={key:0,title:"top",children:[]};return c(t,e),t.children};var d=l,u=a("6e18"),m="/api/admin/rolePermission",p={findAll:function(e){return Object(o["a"])({url:"".concat(m),params:e,method:"get"})},page:function(e){return Object(o["a"])({url:"".concat(m,"/page"),params:e,method:"get"})},get:function(e){return Object(o["a"])({url:"".concat(m,"/").concat(e),method:"get"})},create:function(e){return Object(o["a"])({url:"".concat(m),data:e,method:"post"})},save:function(e){return Object(o["a"])({url:"".concat(m,"/save"),data:e,method:"put"})},delete:function(e){return Object(o["a"])({url:"".concat(m,"/").concat(e),method:"delete"})}},h=p,f=a("4360"),g={components:{Pagination:i["a"]},data:function(){return{addPermission:!1,editPermission:!1,delPermission:!1,setPermission:!1,tableLoading:!1,permissions:[],roles:[],queryParams:{pageNum:1,pageSize:10},total:0,showAddForm:!1,showPermissionForm:!1,editParams:{},selectedPremissionIds:[]}},created:function(){this.addPermission=f["a"].state.user.permissions.indexOf(600101001)>-1,this.editPermission=f["a"].state.user.permissions.indexOf(600101002)>-1,this.delPermission=f["a"].state.user.permissions.indexOf(600101003)>-1,this.setPermission=f["a"].state.user.permissions.indexOf(600101004)>-1,this.getPermissionTree(),this.getRoles()},methods:{getPermissionTree:function(){var e=this;d.tree({status:1}).then((function(t){e.permissions=t.data}))},getRoles:function(){var e=this;""==this.queryParams.name&&(this.queryParams.name=null),this.tableLoading=!0,u["a"].page(this.queryParams).then((function(t){e.tableLoading=!1,e.roles=t.data.records,e.total=t.data.total}))},handleSizeChange:function(e){this.queryParams.pageSize=e,this.getRoles()},handleCurrentChange:function(e){this.queryParams.pageNum=e,this.getRoles()},saveRole:function(){var e=this;this.editParams.id?u["a"].update(this.editParams).then((function(t){e.$message.success("保存成功"),e.showAddForm=!1,e.getRoles()})):u["a"].create(this.editParams).then((function(t){e.$message.success("保存成功"),e.showAddForm=!1,e.getRoles()}))},del:function(e){var t=this;u["a"].delete(e.id).then((function(e){t.$message.success("已删除"),t.getRoles()}))},getPermission:function(e){this.showPermissionForm=!0,this.$nextTick((function(){var t=this;this.$refs.permissionTree.setCheckedNodes([]),this.editParams=e,h.findAll({roleId:e.id}).then((function(e){var a=e.data.filter((function(e){return"full"==e.status})).map((function(e){return e.permissionId}));t.selectedPremissionIds=a}))}))},saveRolePermission:function(){var e=this,t=this.$refs.permissionTree.getCheckedNodes(),a=this.$refs.permissionTree.getHalfCheckedNodes();if(0==t.length)return this.$message.success("请选择权限"),!1;var n=[];t.forEach((function(t){var a={};a.roleId=e.editParams.id,a.permissionId=t.id,a.status="full",n.push(a)})),a.forEach((function(t){var a={};a.roleId=e.editParams.id,a.permissionId=t.id,a.status="half",n.push(a)})),h.save(n).then((function(t){e.$message.success("保存成功"),e.showPermissionForm=!1}))}}},b=g,P=a("4023"),v=Object(P["a"])(b,n,r,!1,null,null,null);t["default"]=v.exports}}]);