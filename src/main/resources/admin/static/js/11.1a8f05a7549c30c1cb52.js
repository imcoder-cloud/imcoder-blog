webpackJsonp([11],{"5Av+":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("spLH"),n=a("vLgD"),i="/api/admin/permission",s={};s.findAll=function(e){return Object(n.a)({url:""+i,params:e,method:"get"})},s.page=function(e){return Object(n.a)({url:i+"/page",params:e,method:"get"})},s.get=function(e){return Object(n.a)({url:i+"/"+e,method:"get"})},s.tree=function(e){return Object(n.a)({url:i+"/tree",params:e,method:"get"})},s.create=function(e){return Object(n.a)({url:i+"/save",data:e,method:"post"})},s.update=function(e){return Object(n.a)({url:i+"/update",data:e,method:"put"})},s.delete=function(e){return Object(n.a)({url:i+"/"+e,method:"delete"})},s.concreteTree=function(e){var t={key:0,title:"top",children:[]};return function e(t,a){a.forEach(function(e){t.key===e.parentId&&(t.children||(t.children=[]),t.children.push({key:e.id,title:e.name,isLeaf:!1}))}),t.children?t.children.forEach(function(t){return e(t,a)}):t.isLeaf=!0}(t,e),t.children};var o=s,l=a("sNer"),d={findAll:function(e){return Object(n.a)({url:"/api/admin/rolePermission",params:e,method:"get"})},page:function(e){return Object(n.a)({url:"/api/admin/rolePermission/page",params:e,method:"get"})},get:function(e){return Object(n.a)({url:"/api/admin/rolePermission/"+e,method:"get"})},create:function(e){return Object(n.a)({url:"/api/admin/rolePermission",data:[e],method:"post"})},save:function(e){return Object(n.a)({url:"/api/admin/rolePermission/save",data:e,method:"put"})},delete:function(e){return Object(n.a)({url:"/api/admin/rolePermission/"+e,method:"delete"})}},c=d,u={components:{Pagination:r.a},data:function(){return{permissions:[],tableLoading:!1,roles:[],queryParams:{pageNum:1,pageSize:10},total:0,showAddForm:!1,editParams:{},selectedPremissionIds:[]}},created:function(){this.getPermissionTree(),this.getRoles()},methods:{getPermissionTree:function(){var e=this;o.tree({status:1}).then(function(t){e.permissions=t.data})},getRoles:function(){var e=this;""==this.queryParams.name&&(this.queryParams.name=null),this.tableLoading=!0,l.a.page(this.queryParams).then(function(t){e.tableLoading=!1,e.roles=t.data.records,e.total=t.data.total})},handleSizeChange:function(e){this.queryParams.pageSize=e,this.getRoles()},handleCurrentChange:function(e){this.queryParams.pageNum=e,this.getRoles()},saveRole:function(){var e=this;this.editParams.id?l.a.update(this.editParams).then(function(t){e.$message.success("保存成功"),e.showAddForm=!1,e.getRoles()}):l.a.create(this.editParams).then(function(t){e.$message.success("保存成功"),e.showAddForm=!1,e.getRoles()})},del:function(e){var t=this;l.a.delete(e.id).then(function(e){t.$message.success("已删除"),t.getRoles()})},getPermission:function(e){var t=this;this.$refs.permissionTree.setCheckedNodes([]),this.editParams=e,c.findAll({roleId:e.id}).then(function(e){var a=e.data.map(function(e){return e.permissionId});t.selectedPremissionIds=a})},saveRolePermission:function(){var e=this,t=this.$refs.permissionTree.getCheckedNodes();if(0==t.length)return this.$message.success("请选择权限"),!1;var a=[];t.map(function(t){var r={};r.roleId=e.editParams.id,r.permissionId=t.id,a.push(r)}),c.save(a).then(function(t){e.$message.success("保存成功")})}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{staticStyle:{display:"flex"},attrs:{gutter:20}},[a("el-col",{staticClass:"mb20",attrs:{xl:18,lg:18,md:14,sm:24,xs:24}},[a("el-card",[a("div",{staticStyle:{"margin-top":"20px"}},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{attrs:{placeholder:"角色名称"},model:{value:e.queryParams.title,callback:function(t){e.$set(e.queryParams,"title",t)},expression:"queryParams.title"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getRoles()}}},[e._v("查询")])],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showAddForm=!0,e.editParams={},e.selectedPremissionIds=[]}}},[e._v("新增")])],1)],1)],1),e._v(" "),a("div",{staticStyle:{padding:"20px"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticStyle:{"margin-bottom":"20px"},attrs:{data:e.roles,"element-loading-background":"rgba(0, 0, 0, 0.3)","element-loading-text":"数据正在加载中","element-loading-spinner":"el-icon-loading"}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"code",label:"编码"}}),e._v(" "),a("el-table-column",{attrs:{prop:"description",label:"描述","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.getPermission(t.row)}}},[e._v("配置权限")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){e.editParams=t.row,e.showAddForm=!0}}},[e._v("编辑")]),e._v(" "),a("el-popconfirm",{staticStyle:{"margin-left":"10px"},attrs:{title:"确定删除本条数据吗？删除后不可恢复。",cancelButtonType:"default"},on:{onConfirm:function(a){return e.del(t.row)}}},["admin"!=t.row.code?a("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("删除")]):e._e()],1)]}}])})],1),e._v(" "),a("pagination",{attrs:{pageNum:e.queryParams.pageNum,pageSize:e.queryParams.pageSize,total:e.total},on:{sizeChange:e.handleSizeChange,currentChange:e.handleCurrentChange}})],1)])],1),e._v(" "),a("el-col",{staticClass:"mb20",attrs:{xl:6,lg:6,md:10,sm:24,xs:24}},[a("el-card",[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("角色权限")]),e._v(" "),null!=e.editParams.id?a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.saveRolePermission}},[e._v("保存")]):e._e()],1),e._v(" "),a("el-tree",{ref:"permissionTree",attrs:{data:e.permissions,"node-key":"id",props:{children:"children",label:"name"},"show-checkbox":"","default-checked-keys":e.selectedPremissionIds}})],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"编辑角色",width:"500px",visible:e.showAddForm},on:{"update:visible":function(t){e.showAddForm=t}}},[a("el-form",{attrs:{model:e.editParams,"label-position":"right","label-width":"60px"}},[a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{attrs:{disabled:"admin"==e.editParams.code,autocomplete:"off",placeholder:"角色名称"},model:{value:e.editParams.name,callback:function(t){e.$set(e.editParams,"name",t)},expression:"editParams.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"编码"}},[a("el-input",{attrs:{disabled:"admin"==e.editParams.code,autocomplete:"off",placeholder:"例如：admin"},model:{value:e.editParams.code,callback:function(t){e.$set(e.editParams,"code",t)},expression:"editParams.code"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{attrs:{type:"textarea",autocomplete:"off",placeholder:"角色描述"},model:{value:e.editParams.description,callback:function(t){e.$set(e.editParams,"description",t)},expression:"editParams.description"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showAddForm=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.saveRole}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]};var p=a("VU/8")(u,m,!1,function(e){a("UqVP")},null,null);t.default=p.exports},UqVP:function(e,t){},sNer:function(e,t,a){"use strict";var r=a("vLgD"),n="/api/admin/role",i={findAll:function(e){return Object(r.a)({url:""+n,params:e,method:"get"})},page:function(e){return Object(r.a)({url:n+"/page",params:e,method:"get"})},get:function(e){return Object(r.a)({url:n+"/"+e,method:"get"})},tree:function(){return Object(r.a)({url:n+"/tree",method:"get"})},create:function(e){return Object(r.a)({url:""+n,data:[e],method:"post"})},update:function(e){return Object(r.a)({url:""+n,data:[e],method:"put"})},delete:function(e){return Object(r.a)({url:n+"/"+e,method:"delete"})}};t.a=i}});